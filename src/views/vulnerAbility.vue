<template>

  <div class="VA">
    <el-row>
      <el-col :span="24">
        <el-card class="box-card">
          <div class="VAHeader">
            <div>
              <el-button type="primary">对当前工程进行漏洞检索</el-button>
              <span style="margin-left: 10px">{{'当前工程ID : '+projectId}}</span>
            </div>
            <el-form style="display: inline-block;right: 0;" inline :model="vulnerInfo">
              <el-form-item>
                <el-input placeholder="请输入漏洞编号" v-model="vulnerInfo.vulnerId"></el-input>
              </el-form-item>
              <el-form-item>
                <el-button type="primary" @click="onSearch">查询</el-button>
              </el-form-item>
            </el-form>
          </div>
        </el-card>
      </el-col>
      <el-col :span="24" style="margin-top: 20px">
        <el-card class="box-card" >
          <h3>近期主要漏洞</h3>
          <el-table
              :data="vulnerabilityList"
              stripe
              style="width: 100%;height: 25vh;overflow: auto">
            <el-table-column
                prop="vulnId"
                label="漏洞编号"
                width="180">
            </el-table-column>
            <el-table-column
                :show-overflow-tooltip="true"
                prop="description"
                label="漏洞描述"
                width="180">
            </el-table-column>
            <el-table-column
                :show-overflow-tooltip="true"
                prop="references"
                label="相关链接">
            </el-table-column>
            <el-table-column
                prop="published"
                label="上传时间">
            </el-table-column>
            <el-table-column
                prop="updated"
                label="最后更新时间">
            </el-table-column>
          </el-table>
        </el-card>
      </el-col>
      <el-col :span="24" >
        <el-card class="box-card" style="margin-top: 20px">
          <h3>开源协议列表</h3>
          <el-collapse  accordion  v-for="item in this.licenseGroupList">
            <el-collapse-item :title="item.name" name="1">
              <h3>{{ item.name }}</h3>
              <el-table
                  :data="item.licenses"
                  stripe
                  style="width: 100%">
                <el-table-column
                    prop="uuid"
                    label="协议编号"
                    width="180">
                </el-table-column>
                <el-table-column
                    prop="name"
                    label="协议名称"
                    width="180">
                </el-table-column>
                <el-table-column
                    prop="licenseId"
                    label="许可证编号">
                </el-table-column>
                <el-table-column
                    prop="isOsiApproved"
                    label="OSI授权">
                </el-table-column>
                <el-table-column
                    prop="isFsfLibre"
                    label="自由软件基金会">
                </el-table-column>
                <el-table-column
                    prop="isDeprecatedLicenseId"
                    label="弃用">
                </el-table-column>
                <el-table-column
                    prop="isCustomLicense"
                    label="自定义许可证">
                </el-table-column>
              </el-table>
            </el-collapse-item>
          </el-collapse>

        </el-card>
      </el-col>
    </el-row>
  </div>


</template>

<script>
import {getData, getProjectStatus} from "@/api";
import request from "@/utils/request";
import Cookie from "js-cookie";
import http from "@/utils/request";

export default {

  data: function () {
    return {
      vulnerInfo:{
        vulnerId:'',
      },
      projectId:Cookie.get('projectId'),
      vulnerabilityList:[],
      licenseGroupList:[],
      projectLoudongList:[],
      componentList:[],
      currentMetricsList:[],
      allProjectResult:[],
      refresh:[]
    };
  },
  methods: {
    onSearch(){
      this.total=this.tableData.length
      let tables = [];
      for (let i = 0; i < this.total; i++) {
        if (this.tableData[i].nepId==this.vulnerInfo.vulnerId||(!this.vulnerInfo.vulnerId)) {
          tables.push(this.tableData[i]);
        }
        this.showTableData = tables;
      }
      this.total=this.showTableData.length
    },


    getList(){
      http.get('/uranus/vulnerability').then(({data})=>{
        //近期重要漏洞（查询工程漏洞）
        this.vulnerabilityList=data.data;
      })
      http.post('/uranus/finding/project/analyze'+'?uuid='+'4cea96fc-e50f-4839-8ec8-0c114497d73b').then(({data})=>{
        //对指定工程进行漏洞分析
      })
      http.get('/uranus/licenseGroup').then(({data})=>{
        //查询开源协议列表（简化版）
        this.licenseGroupList=data.data

        this.licenseGroupList.forEach(function (item){
          console.log(item)
          for(let i=0;i<item.length;i++){
            for(let j=0;j<item[i].licenses.length;j++){
              item[i].licenses[j].isOsiApproved=item[i].licenses[j].isOsiApproved?'是':'否';
              item[i].licenses[j].isFsfLibre=item[i].licenses[j].isFsfLibre?'是':'否';
              item[i].licenses[j].isDeprecatedLicenseId=item[i].licenses[j].isDeprecatedLicenseId?'是':'否';
              item[i].licenses[j].isCustomLicense=item[i].licenses[j].isCustomLicense?'是':'否';
            }

          }

        })
        console.log('licenseGroupList'+this.licenseGroupList)
      })
      http.get('/uranus/project').then(({data})=>{
        //查询工程漏洞列表（简化版）
      })

      http.get('/uranus/metrics/project/current'+'?uuid='+'4cea96fc-e50f-4839-8ec8-0c114497d73b').then(({data})=>{
        //查询指定工程当前指标
      })
      http.get('/uranus/finding/project'+'?uuid='+'4cea96fc-e50f-4839-8ec8-0c114497d73b').then(({data})=>{
        //返回指定工程所有结果列表
      })
      http.get('/uranus/metrics/project/refresh'+'?uuid='+'4cea96fc-e50f-4839-8ec8-0c114497d73b').then(({data})=>{
        //请求刷新指定工程指标
      })
      http.get('/uranus/bom/cyclonedx/project'+'?uuid='+'4cea96fc-e50f-4839-8ec8-0c114497d73b').then(({data})=>{
        //以标准格式返回指定工程依赖元数据
      })
    }
  },
  mounted() {
    //待更改为getList http形式
    this.getList()

  },
  computed: {
    // 这里定义上传文件时携带的参数，即表单数据
    upData: function () {
      return {
        /*projectId: Cookie.get("projectId"),*/
        /*body: JSON.stringify(this.form)*/
      }
    }
  },
//123123
}
</script>

<style scoped lang="less">
.VAHeader{
  display: flex;
  justify-content: space-between;
  align-items: center;
}
::-webkit-scrollbar {
  width: 0 !important;
  height: 0 !important;
}
.VA{
  height: 80vh; //一定要设置，保证占满
  overflow: auto;
}
</style>
